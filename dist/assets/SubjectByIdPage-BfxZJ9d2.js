import{c as v,a as x,j as e,P as t,L as o,T as i,B as N}from"./index-D15ONH7R.js";import{a as w,B as S}from"./analysis.api-BrT1xk06.js";import{S as T}from"./Stars-liMOTKeD.js";import{u as b}from"./subject.api-CTwlbnQ4.js";import{u as _}from"./useAppSelector-Cdm4GsGN.js";const G=()=>{const{id:l}=v(),{city:c}=_(s=>s.system),{isLoading:h,data:a}=b({city:c,id:l}),[f,{isLoading:d}]=w(),[r,n]=x.useState(null);x.useEffect(()=>{a&&a.summary?n(a.summary.content.summary):n(null)},[a]);const j=async()=>{try{if(a&&c&&l&&a.reviews.length>0){const s=await f({city:c,related_id:Number(l),review_ids:a.reviews.slice(0,10).map(({id:m})=>m)}).unwrap();n(s.summary)}}catch(s){console.error("Ошибка при получении сводки:",s)}};if(h)return e.jsx(t,{className:"flex flex-1 justify-center items-center p-3",children:e.jsx(o,{})});if(!a)return e.jsx(t,{className:"flex flex-1 justify-center items-center p-3",children:e.jsx(i.Title,{as:"h3",children:"Простите, предмета нет"})});const{average_rating:u,name:p,number_of_reviews:y,reviews:g}=a;return e.jsxs(t,{className:"flex flex-col gap-4 flex-1 p-3",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(i.Title,{as:"h3",children:p}),e.jsxs(i.Title,{as:"h4",children:["Средняя оценка: ",u]})]}),d?e.jsx("div",{className:"flex p-4 justify-center items-center",children:e.jsx(o,{})}):r?e.jsxs("div",{className:"grid sm:grid-cols-[2fr_1fr] max-sm:grid-rows-2 gap-2 p-2 max-h-[90vh] min-h-[80vh]",children:[e.jsx("div",{className:"w-full",children:e.jsx(S,{loading:d,data:(r==null?void 0:r.evaluation_criteria)||[]})}),e.jsxs(t,{variant:"white",className:"flex flex-col gap-2 rounded-lg p-3",children:[e.jsx(i.Title,{as:"h3",children:"Сводки"}),r==null?void 0:r.recommendations.map(({text:s},m)=>e.jsx(t,{className:"p-2",children:s},m))]})]}):e.jsx("div",{className:"flex p-4 justify-center items-center",children:e.jsx(i.Title,{as:"h3",children:"Анализ отсутсвует"})}),!r&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex p-4 justify-center items-center",children:e.jsx(N,{onClick:j,children:"Сгенерировать"})}),e.jsxs("div",{className:"flex justify-center",children:[e.jsx("br",{}),e.jsx("p",{children:"*примерное ожидание 5-15мин"})]})]}),e.jsxs("div",{children:[e.jsxs(i.Title,{className:"my-2",as:"h4",children:["Количество отзывов: ",y]}),e.jsx("div",{className:"flex flex-col gap-2",children:g.map(s=>e.jsxs(t,{variant:"white",className:"shadow-md rounded-md p-3 flex flex-col gap-2",children:[e.jsx(i.Title,{as:"h4",children:s.comment}),e.jsx(T,{starClassname:"h-8 w-8",rating:s.rating})]},s.id))})]})]})};export{G as default};
