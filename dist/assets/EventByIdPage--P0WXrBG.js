import{r as O,j as e,T as n,c as k,a as v,P as o,L as j,B as p}from"./index-D15ONH7R.js";import{u as L,B as R}from"./analysis.api-BrT1xk06.js";import{a as A}from"./event.api-C3CqlyH4.js";import{u as q}from"./useAppSelector-Cdm4GsGN.js";import{T as x}from"./TextField-CMRjs2T9.js";import{S as y}from"./Stars-liMOTKeD.js";const D=O.injectEndpoints({endpoints:l=>({addEventReview:l.mutation({query:({city:t,...c})=>({method:"POST",url:`/review_event?city=${t}`,body:c})}),addSubjectReview:l.mutation({query:t=>({method:"POST",url:"/add_review",body:t})})})}),{useAddEventReviewMutation:F,useAddSubjectReviewMutation:W}=D,M="_modalOverlay_1oi7c_1",G="_modalContent_1oi7c_27",I="_closeButton_1oi7c_45",Q="_modalBody_1oi7c_65",f={modalOverlay:M,modalContent:G,closeButton:I,modalBody:Q},z=({isOpen:l,onClose:t,title:c,children:i})=>l?e.jsx("div",{className:f.modalOverlay,onClick:t,children:e.jsxs("div",{className:f.modalContent,onClick:u=>u.stopPropagation(),children:[e.jsx(n.Title,{as:"h2",className:"text-center",children:c}),e.jsx("div",{className:f.modalBody,children:i})]})}):null,X=()=>{const{id:l}=k(),{city:t}=q(a=>a.system),{isLoading:c,data:i,refetch:u}=A({city:t,id:l}),[_,{isLoading:g}]=L(),[r,N]=v.useState(null),[C]=F(),[w,h]=v.useState(!1),[d,m]=v.useState({author:""}),b=async()=>{try{if(i&&t&&l&&i.reviews.length!==0){const a=await _({city:t,related_id:Number(l),review_ids:i.reviews.slice(0,10).map(({id:s})=>s)}).unwrap();N(a)}}catch(a){console.log(a)}},S=async a=>{a.preventDefault(),await C({...d,event_id:Number(l),city:t}),await u(),h(!1)};if(c)return e.jsx(o,{className:"flex flex-1 justify-center items-center p-3",children:e.jsx(j,{})});if(c)return e.jsx(o,{className:"flex flex-1 justify-center items-center p-3",children:e.jsx(j,{})});if(!i)return e.jsx(o,{className:"flex flex-1 justify-center items-center p-3",children:e.jsx(n.Title,{as:"h3",children:"Простите, мероприятия нет"})});const{average_rating:B,name:T,number_of_reviews:P,reviews:E}=i;return e.jsxs(e.Fragment,{children:[e.jsx(z,{onClose:()=>h(!1),isOpen:w,title:"Новый отзыв",children:e.jsxs("form",{className:"flex flex-col gap-2 p-2 mt-3",onSubmit:S,children:[e.jsx(x,{required:!0,label:"Автор",value:d.author,onChange:a=>m(s=>({...s,author:a.target.value}))}),e.jsx(x,{label:"Плюсы",value:d.positive_comment,onChange:a=>m(s=>({...s,positive_comment:a.target.value}))}),e.jsx(x,{label:"Минусы",value:d.negative_comment,onChange:a=>m(s=>({...s,aunegative_commentthor:a.target.value}))}),e.jsx(x,{label:"Дополнительно",value:d.additionally,onChange:a=>m(s=>({...s,additionally:a.target.value}))}),e.jsx(y,{starClassname:"h-8 w-8",rating:d.rating||0,onStarClick:a=>m(s=>({...s,rating:a}))}),e.jsx(p,{variant:"large",className:"mt-2",children:"Отправить"})]})}),e.jsxs(o,{className:"flex flex-col gap-4 flex-1 p-3",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(n.Title,{as:"h3",children:T}),e.jsxs(n.Title,{as:"h4",children:["Средняя оценка: ",B]})]}),g?e.jsx("div",{className:"flex p-4 justify-center items-center",children:e.jsx(j,{})}):r?e.jsxs("div",{className:"grid sm:grid-cols-[2fr_1fr] max-sm:grid-rows-2 gap-2 p-2 max-h-[90vh] min-h-[80vh]",children:[e.jsx("div",{className:"w-full",children:e.jsx(R,{loading:g,data:(r==null?void 0:r.evaluation_criteria)||[]})}),e.jsxs(o,{variant:"white",className:"flex flex-col gap-2  rounded-lg p-3",children:[e.jsx(n.Title,{as:"h3",children:"Рекомендации"}),r==null?void 0:r.summary.recommendations.map(({text:a})=>e.jsx(o,{className:"p-2",children:a}))]})]}):e.jsx("div",{className:"flex p-4 justify-center items-center",children:e.jsx(p,{onClick:b,children:"Сгенерировать сводку"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center my-2",children:[e.jsxs(n.Title,{className:"my-2",as:"h4",children:["Количество отзывов: ",P]}),e.jsx(p,{onClick:()=>h(!0),children:"Новый отзыв"})]}),e.jsx("div",{className:"flex flex-col gap-3",children:E.map(a=>e.jsxs(o,{variant:"white",className:"shadow-md rounded-md p-3 flex flex-col gap-2",children:[e.jsxs(n.Paragraph,{variant:"button",children:["Автор: ",a.author?a.author:"Отсутствует"]}),e.jsxs(n.Paragraph,{variant:"body",children:["Плюсы: ",a.positive_comment?a.positive_comment:"Отсутствует"]}),e.jsxs(n.Paragraph,{variant:"body",children:["Минусы: ",a.negative_comment?a.negative_comment:"Отсутствует"]}),e.jsxs(n.Paragraph,{variant:"caption",children:["Доп.: ",a.additionally?a.additionally:"Отсутствует"]}),e.jsx(y,{starClassname:"h-6 w-6",rating:a.rating})]}))})]})]})]})};export{X as default};
