import{c as v,a as x,j as e,P as l,L as o,T as i,B as N}from"./index-B9-aZz-R.js";import{a as w,B as S}from"./analysis.api-Bz0JSCEP.js";import{S as T}from"./Stars-BFtIPY_r.js";import{u as _}from"./subject.api-gXnHSYT9.js";import{u as L}from"./useAppSelector-BTsF-SKP.js";const G=()=>{const{id:t}=v(),{city:c}=L(a=>a.system),{isLoading:h,data:s}=_({city:c,id:t}),[f,{isLoading:d}]=w(),[r,n]=x.useState(null);x.useEffect(()=>{s&&s.summary?n(s.summary.content.summary):n(null)},[s]);const j=async()=>{if(((s==null?void 0:s.reviews.length)||0)<10){alert("Простите, невозможен анализ, так как слишком мало отзывов");return}try{if(s&&c&&t&&s.reviews.length>0){const a=await f({city:c,related_id:Number(t),review_ids:s.reviews.slice(0,10).map(({id:m})=>m)}).unwrap();n(a.summary)}}catch(a){console.error("Ошибка при получении сводки:",a)}};if(h)return e.jsx(l,{className:"flex flex-1 justify-center items-center p-3",children:e.jsx(o,{})});if(!s)return e.jsx(l,{className:"flex flex-1 justify-center items-center p-3",children:e.jsx(i.Title,{as:"h3",children:"Простите, предмета нет"})});const{average_rating:u,name:p,number_of_reviews:g,reviews:y}=s;return e.jsxs(l,{className:"flex flex-col gap-4 flex-1 p-3",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(i.Title,{as:"h3",children:p}),e.jsxs(i.Title,{as:"h4",children:["Средняя оценка: ",u]})]}),d?e.jsx("div",{className:"flex p-4 justify-center items-center",children:e.jsx(o,{})}):r?e.jsxs("div",{className:"grid sm:grid-cols-[2fr_1fr] max-sm:grid-rows-2 gap-2 p-2 max-h-[90vh] min-h-[80vh]",children:[e.jsx("div",{className:"w-full",children:e.jsx(S,{loading:d,data:(r==null?void 0:r.evaluation_criteria)||[]})}),e.jsxs(l,{variant:"white",className:"flex flex-col gap-2 rounded-lg p-3",children:[e.jsx(i.Title,{as:"h3",children:"Сводки"}),r==null?void 0:r.recommendations.map(({text:a},m)=>e.jsx(l,{className:"p-2",children:a},m))]})]}):e.jsx("div",{className:"flex p-4 justify-center items-center",children:e.jsx(i.Title,{as:"h3",children:"Анализ отсутсвует"})}),!r&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex p-4 justify-center items-center",children:e.jsx(N,{onClick:j,children:"Сгенерировать"})}),e.jsxs("div",{className:"flex justify-center",children:[e.jsx("br",{}),e.jsx("p",{children:"*примерное ожидание 5-15мин"})]})]}),e.jsxs("div",{children:[e.jsxs(i.Title,{className:"my-2",as:"h4",children:["Количество отзывов: ",g]}),e.jsx("div",{className:"flex flex-col gap-2",children:y.map(a=>e.jsxs(l,{variant:"white",className:"shadow-md rounded-md p-3 flex flex-col gap-2",children:[e.jsx(i.Title,{as:"h4",children:a.comment}),e.jsx(T,{starClassname:"h-8 w-8",rating:a.rating})]},a.id))})]})]})};export{G as default};
