import{r as L,u as P,a as s,j as e,P as v,L as _,T as p,B as j}from"./index-B9-aZz-R.js";import{u as A}from"./event.api-Myid_Vzp.js";import{T as x}from"./TextField-CG6ONMtj.js";const D=L.injectEndpoints({endpoints:l=>({getCities:l.query({query:()=>"/university_branches"})})}),{useGetCitiesQuery:k}=D,O=()=>{const l=P(),[i,y]=s.useState(""),[o,g]=s.useState(""),[r,b]=s.useState(""),[c,N]=s.useState(""),[d,C]=s.useState(null),[S,{isLoading:u,error:n}]=A(),{data:m,isLoading:T}=k(),w=async a=>{if(a.preventDefault(),!i||!o||!r){alert("Все поля должны быть заполнены!");return}try{await S({event_name:i,place:o,city:r}),alert("Мероприятие создано!"),l("/event")}catch(t){console.error(t),alert("Ошибка при создании мероприятия.")}},E=a=>{const t=a.target.files[0];t&&C(t)},F=async a=>{a.preventDefault();const t=c||r;if(!d||!t){alert("Пожалуйста, выберите файл и город для загрузки!");return}const h=new FormData;h.append("file",d);const q=encodeURIComponent(t);try{if(!(await fetch(`https://pepper-coding.online/upload_data?university_branch_name=${q}`,{method:"POST",headers:{accept:"application/json","Content-Type":"multipart/form-data"},body:h})).ok)throw new Error("Ошибка при загрузке файла.");alert("Файл успешно загружен!")}catch(f){console.error(f),alert("Ошибка при загрузке файла.")}};return u||T?e.jsx(v,{className:"flex-1 flex flex-col p-2",children:e.jsx("div",{className:"flex justify-center items-center",children:e.jsx(_,{})})}):e.jsx("div",{className:"max-w-[700px] w-full mx-auto p-4",children:e.jsxs(v,{className:"flex-1 flex flex-col p-2",children:[e.jsx(p.Title,{as:"h3",className:"m-2",children:"Создать новое мероприятие"}),e.jsxs("form",{onSubmit:w,className:"flex flex-col gap-4",children:[e.jsx(x,{label:"Название мероприятия",value:i,onChange:a=>y(a.target.value),required:!0}),e.jsx(x,{label:"Место проведения",value:o,onChange:a=>g(a.target.value),required:!0}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"city",className:"block mb-1",children:"Город"}),e.jsxs("select",{id:"city",value:r,onChange:a=>b(a.target.value),className:"w-full p-2 border border-gray-300 rounded",required:!0,children:[e.jsx("option",{value:"",children:"Выберите город"}),m==null?void 0:m.map(a=>e.jsx("option",{value:a,children:a},a))]})]}),e.jsx(j,{type:"submit",disabled:u,children:"Создать мероприятие"})]}),e.jsxs("form",{onSubmit:F,className:"flex flex-col gap-4 mt-8",children:[e.jsx(p.Title,{as:"h3",className:"m-2",children:"Загрузить csv файл с отзывами о предметах"}),e.jsx("input",{type:"file",accept:".csv",onChange:E,className:"p-2 border border-gray-300 rounded"}),e.jsx("div",{className:"mt-2",children:e.jsx(x,{label:"Введите название города",value:c,onChange:a=>N(a.target.value),required:!0})}),e.jsx(j,{type:"submit",disabled:u||!d||!c,children:"Загрузить CSV-файл"})]}),n&&e.jsxs(p.Title,{as:"h3",className:"text-red-500",children:["Ошибка:","message"in n?n.message:JSON.stringify(n)]})]})})};export{O as default};
